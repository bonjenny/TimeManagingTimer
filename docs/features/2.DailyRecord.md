# 일간 기록

일간 기록 페이지는 앱의 메인 화면으로, 하루 동안의 작업을 기록하고 관리합니다. 타이머로 정확한 시간을 측정하고, 간트차트로 시각적으로 확인할 수 있습니다. 모든 기록은 브라우저 LocalStorage에 즉시 저장됩니다.

## 1. 간트 차트 (Timeline)

화면 중앙 상단에는 06:00부터 익일 06:00까지의 시간 축을 가진 간트 차트가 표시됩니다.

### 기능
- **시각화**: 작업 내역이 시간대별 막대(Bar)로 표시됩니다. 카테고리별로 색상이 구분됩니다.
- **실시간 표시**: 현재 시간 위치에 빨간색 선이 표시되며, 진행 중인 작업은 종료 시간이 실시간으로 늘어납니다.
- **드래그로 추가**: 빈 영역을 드래그하면 해당 시간대에 **수동으로 작업을 추가**할 수 있습니다. (예: 회의 등 타이머를 못 켠 경우)
  - 단순 클릭 시 기본 1시간 작업이 생성됩니다.
  - 기존 작업 행에서 드래그하면 해당 작업에 세션을 추가할 수 있습니다.
  - (v0.14.4) 클릭한 행을 기준으로 세션이 추가되며, 여러 줄이 있어도 한 줄 밀리는 현상이 수정되었습니다.
- **정보 확인**: 막대에 마우스를 올리면 상세 시간과 소요 시간이 표시됩니다.
- **작업 수정**: 막대를 **더블클릭**하면 수정 모달이 열립니다. **우클릭**하면 수정/삭제 메뉴가 표시됩니다.
- **시간 조절 (리사이즈)**: 완료된 작업 막대의 양끝을 드래그하여 시작/종료 시간을 조절할 수 있습니다. 진행 중인 작업은 시작 시간만 조절 가능합니다.

### 충돌 알림 (v0.10.4)
작업 시간이 겹칠 경우 **비차단 알림(Snackbar)**이 화면 상단에 표시됩니다.
- 경미한 겹침(5분 이내)은 **자동 조정**되며, "시간 충돌로 인해 자동 조정되었습니다" 알림이 표시됩니다.
- 심각한 겹침은 **겹침을 허용**하고 "시간이 겹치는 작업이 있습니다" 경고 알림이 표시됩니다.
- 이전 버전의 confirm 대화상자가 제거되어 작업 흐름이 끊기지 않습니다.

---

## 2. 작업 추가 및 타이머 시작

### 중간 입력 바 사용
간트 차트 바로 아래에 위치한 **입력 바**를 통해 빠르게 작업을 시작할 수 있습니다.

1. **작업명 입력**: "무엇을 하고 계신가요?" 란에 작업 제목 입력 (필수)
2. **게시판 번호**: (선택) 프로젝트/게시판 식별 번호 입력
3. **카테고리**: (선택) 업무 분류 선택 (분석, 개발, 회의 등)
4. **시작**: `Enter` 키 또는 `▶` 버튼 클릭

### 자동 완성
입력 바는 **최근 30일간** 기록된 작업 내역을 바탕으로 자동 완성을 제공합니다. 이전에 입력했던 작업명을 선택하면 빠르게 시작할 수 있습니다.

### 활성 타이머 (Active Timer)
작업을 시작하면 입력 바 아래에 **활성 타이머** 카드가 나타납니다.
- **시간 표시**: 현재 작업의 경과 시간이 실시간으로 표시됩니다.
- **제어**: 일시정지, 재개, 완료 버튼으로 타이머를 제어할 수 있습니다.

---

## 3. 작업 기록 리스트 (Timer List)

화면 하단에는 작업 기록들이 그룹화되어 표시됩니다.

### 리스트 구성
- **그룹화**: 동일한 작업명(Title)을 가진 세션들이 하나의 그룹으로 묶여 표시됩니다.
- **상태 표시**: 진행 중인 작업은 배경색과 타이머가 강조됩니다.
- **완료 보기 토글**: 우측 상단 스위치로 완료된 작업을 숨기거나 볼 수 있습니다. 설정값은 localStorage에 저장되어 새로고침 후에도 유지됩니다. (v0.14.5)

### 주요 기능
| 아이콘 | 기능 | 설명 |
|---|---|---|
| `▶` | **재시작** | 해당 작업 설정(제목, 번호, 카테고리)으로 새 타이머 시작 |
| `✏️` | **수정** | 작업 정보(제목, 번호, 카테고리) 수정 |
| `🗑️` | **삭제** | 해당 작업 세션 삭제 |
| `✅` | **완료** | (TODO) 그룹 단위 완료 처리 (현재 자동 완료 로직 적용됨) |

> **참고**: 작업 기록을 수정하면 해당 그룹의 모든 세션에 일괄 적용되지 않고, 선택한 **개별 세션** 또는 **그룹 전체**(구현 방식에 따라 다름) 정보가 업데이트됩니다.

---

## 4. 데이터 구조 및 저장

### 저장 방식
- **LocalStorage**: `timekeeper-storage` 키값으로 브라우저에 저장됩니다.
- **데이터 보존**: 인터넷 연결과 무관하게 저장되지만, 브라우저 캐시를 삭제하면 날아갈 수 있으니 주의하세요.

### 데이터 필드
```typescript
interface TimerLog {
  id: string;          // 고유 ID
  title: string;       // 작업명
  boardNo?: string;    // 게시판 번호
  category?: string;   // 카테고리
  startTime: number;   // 시작 시간 (Timestamp)
  endTime?: number;    // 종료 시간 (Timestamp)
  status: 'RUNNING' | 'PAUSED' | 'COMPLETED'; // 상태
  pausedDuration: number; // 일시정지 시간 합계 (초)
}
```

### 소요시간 계산 로직

소요시간은 다음과 같이 계산됩니다:

```
소요시간 = (종료시간 - 시작시간) - 점심시간 - 일시정지시간
```

#### 비정상 데이터 처리 (v0.12.4)

일시정지시간(`pausedDuration`)이 전체 작업시간보다 클 경우 비정상 데이터로 간주하여 무시합니다:

```typescript
// pausedDuration이 전체 duration보다 크면 비정상 데이터로 무시
const safePaused = pausedDuration > durationSec ? 0 : pausedDuration;
const result = durationSec - safePaused;
```

| 상황 | pausedDuration | 전체 duration | 처리 | 결과 |
|------|---------------|---------------|------|------|
| 정상 | 10분 | 60분 | 그대로 사용 | 50분 |
| 비정상 | 28분 | 24분 | 무시 (0으로 처리) | 24분 |

---

## 5. 타이머 상태 정의

타이머(세션)는 아래 4가지 상태 중 하나를 가집니다. 각 상태의 의미와 전환 조건을 명확히 정의합니다.

### 상태 종류

| 상태 | 설명 | UI 표시 | endTime 설정 여부 |
|------|------|---------|-------------------|
| `IDLE` | 초기 상태 (타이머 시작 전) | - | X |
| `RUNNING` | 작업 진행 중 | "진행 중" 칩(Chip) | X |
| `PAUSED` | 일시정지 상태 | 종료 시간(주황색) | O |
| `COMPLETED` | 작업 완료 | 종료 시간(기본색) | O |

### 일시정지(PAUSED) 상태 정의

**일시정지**는 현재 진행 중인 작업을 임시로 멈춘 상태입니다. 다음과 같은 상황에서 발생합니다:

1. **명시적 일시정지**: 사용자가 활성 타이머의 일시정지 버튼을 클릭
2. **새 작업 시작**: 진행 중인 작업이 있는 상태에서 새 작업을 시작하면, 기존 작업은 자동으로 PAUSED 상태로 전환되어 logs에 저장
3. **단축키 사용**: `Alt + S` 단축키로 타이머 일시정지/재개

#### 일시정지 시 기록되는 시간

| 필드 | 의미 | 용도 |
|------|------|------|
| `lastPausedAt` | 마지막으로 일시정지한 시각 | UI에서 종료 시간 표시 |
| `endTime` | 세션 종료 시각 | 소요 시간 계산, 간트차트 렌더링 |
| `pausedDuration` | 누적 일시정지 시간(초) | 순수 작업 시간 계산 시 제외 |

#### 종료 시간 표시 우선순위 (UI)

PAUSED 상태에서 종료 시간을 표시할 때 다음 우선순위로 값을 선택합니다:

```
1. lastPausedAt (가장 최근 일시정지 시각)
2. endTime (세션 종료 시각)
3. startTime (폴백 - 시작 시각)
```

이 우선순위는 기존 데이터 호환성을 위해 설정되었습니다.

### PAUSED vs COMPLETED 차이

| 구분 | PAUSED | COMPLETED |
|------|--------|-----------|
| **의미** | 임시 중단 (재개 가능) | 작업 완료 (재개 불가) |
| **재개** | O (activeTimer로 복귀 가능) | X (새 세션으로만 시작) |
| **UI 색상** | 주황색 (warning) | 기본색 |
| **사용 시나리오** | 잠시 쉬거나 다른 작업 전환 | 해당 작업 완전 종료 |

### 완료 취소 (reopenTimer)

완료된 작업의 체크 아이콘을 다시 클릭하면 **완료 취소**가 됩니다.

- 상태가 `COMPLETED` → `PAUSED`로 변경됩니다.
- **endTime은 기존 값이 그대로 유지됩니다.** (v0.14.5) 이전에는 endTime이 초기화되어 종료시간이 현재 시간으로 바뀌는 문제가 있었습니다.
- activeTimer로 이동하지 않으므로, 타이머가 자동 시작되지 않습니다.

### 상태 전환 다이어그램

```
        [시작]
           │
           ▼
      ┌─────────┐
      │  IDLE   │
      └────┬────┘
           │ startTimer()
           ▼
      ┌─────────┐  pauseTimer()   ┌─────────┐
      │ RUNNING │ ───────────────▶│ PAUSED  │
      └────┬────┘                 └────┬────┘
           │                           │
           │ completeTimer()           │ resumeTimer()
           │                           │
           ▼                           ▼
      ┌─────────┐                 ┌─────────┐
      │COMPLETED│                 │ RUNNING │
      └─────────┘                 └─────────┘
```

---

## [TODO] 미구현 기능 (Future Features)

아래 기능들은 현재 기획 단계이거나 개발 예정입니다.

- **[x] 날짜 이동**: ~~현재는 '오늘' 날짜만 기록 가능합니다.~~ 과거 날짜 조회 및 수정 기능 구현 완료 (v0.6.0)
- **[x] 점심시간 제외**: ~~점심시간(예: 12:00~13:00)을 총 소요 시간 계산에서 자동으로 제외하는 로직.~~ 구현 완료 (v0.7.0)
- **[x] 휴지통**: ~~삭제한 작업을 임시 보관하고 복구하는 기능.~~ 구현 완료 (v0.7.0)
- **[x] 간트차트 수정**: ~~간트차트 막대를 드래그하여 시간을 수정(Resize, Move)하는 기능.~~ 구현 완료 (v0.6.0)
- **[ ] 작업 완료 처리**: 그룹 단위로 작업을 '완료' 처리하여 더 이상 재시작하지 않도록 표시하는 기능.
